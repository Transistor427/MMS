# F-CRM - Система мониторинга и управления 3D-принтерами

Современная веб-система для мониторинга и управления 3D-принтерами через Moonraker API. Система позволяет управлять несколькими принтерами одновременно, отслеживать их статус, загружать файлы и контролировать процесс печати.

## Возможности

- ✅ Подключение к принтерам по IP-адресу через Moonraker API
- ✅ Добавление и удаление принтеров
- ✅ Загрузка файлов (.gcode, .3mf) на принтеры
- ✅ Запуск, пауза, возобновление и отмена печати
- ✅ Отображение статуса принтера в реальном времени
- ✅ Просмотр изображения с веб-камеры принтера
- ✅ Отображение прогресса печати и оставшегося времени
- ✅ Просмотр количества слоев и общей информации о печати
- ✅ Управление подсветкой принтера
- ✅ Фильтрация и группировка принтеров по статусу
- ✅ Визуальные оповещения об ошибках и завершении печати
- ✅ Адаптивный веб-интерфейс

## Требования

- Python 3.8 или выше
- Принтеры с установленным Moonraker
- Веб-камеры на принтерах (опционально)
- Сетевое подключение к принтерам

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone <url-репозитория>
cd F-CRM
```

### 2. Создание виртуального окружения

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Запуск системы

```bash
python app.py
```

Система будет доступна по адресу: `http://localhost:5000`

## Настройка принтеров

### Подготовка принтера

1. Убедитесь, что на принтере установлен Moonraker
2. Проверьте, что Moonraker доступен по IP-адресу принтера на порту 7125
3. Убедитесь, что веб-камера настроена и доступна на порту 8080

### Добавление принтера в систему

1. Откройте веб-интерфейс системы
2. Нажмите кнопку "Добавить принтер"
3. Заполните форму:
   - **Название принтера**: Произвольное имя для идентификации
   - **IP-адрес**: IP-адрес принтера в локальной сети
   - **Порт Moonraker**: Обычно 7125
   - **Теги**: Дополнительные метки для группировки (опционально)

## Использование

### Основные функции

#### Управление печатью
- **Запуск печати**: Выберите файл из списка доступных на принтере
- **Пауза/Возобновление**: Приостановка и возобновление текущей печати
- **Отмена печати**: Полная остановка процесса печати

#### Мониторинг
- **Статус принтера**: Отображение текущего состояния (печать, пауза, ожидание, ошибка)
- **Прогресс печати**: Процент выполнения и оставшееся время
- **Веб-камера**: Прямая трансляция с принтера
- **Температуры**: Текущие температуры экструдера и стола

#### Управление файлами
- **Загрузка файлов**: Отправка .gcode и .3mf файлов на принтер
- **Просмотр файлов**: Список всех файлов на принтере
- **Запуск печати**: Выбор файла для печати

### Фильтрация и поиск

- **По статусу**: Все, Готовы к запуску, Требуют внимания, Завершенные задачи
- **По тегам**: Группировка принтеров по меткам
- **По модели**: Фильтрация по типу принтера

### Визуальные оповещения

- **Ошибки**: Красная мигающая рамка при ошибке печати
- **Завершение**: Зеленая мигающая рамка при завершении печати
- **Уведомления**: Всплывающие сообщения о статусе операций

## Структура проекта

```
F-CRM/
├── app.py                 # Основной Flask сервер
├── requirements.txt       # Зависимости Python
├── static/               # Веб-интерфейс
│   ├── index.html        # Главная страница
│   ├── styles.css        # Стили
│   └── script.js         # JavaScript логика
├── uploads/              # Папка для временных файлов
├── printers.json         # База данных принтеров
├── print_jobs.json       # База данных заданий
└── README.md            # Документация
```

## API Endpoints

### Принтеры
- `GET /api/printers` - Получение списка принтеров
- `POST /api/printers` - Добавление нового принтера
- `DELETE /api/printers/<id>` - Удаление принтера
- `GET /api/printers/<id>/status` - Статус принтера

### Печать
- `POST /api/printers/<id>/print/start` - Запуск печати
- `POST /api/printers/<id>/print/pause` - Пауза печати
- `POST /api/printers/<id>/print/resume` - Возобновление печати
- `POST /api/printers/<id>/print/cancel` - Отмена печати

### Файлы
- `POST /api/printers/<id>/upload` - Загрузка файла
- `GET /api/printers/<id>/files` - Список файлов

### Дополнительно
- `POST /api/printers/<id>/light/toggle` - Переключение подсветки

## Настройка Moonraker

Убедитесь, что в конфигурации Moonraker включены необходимые компоненты:

```ini
[server]
host: 0.0.0.0
port: 7125
enable_debug_logging: False

[authorization]
trusted_clients:
    10.0.0.0/8
    127.0.0.0/8
    169.254.0.0/16
    172.16.0.0/12
    192.168.0.0/16
    FE80::/10
    ::1/128

[octoprint_compat]

[history]

[update_manager]
enable_auto_refresh: True

[update_manager client fluidd]
type: web
repo: fluidd-core/fluidd
path: ~/fluidd

[webcam]
stream_url: http://localhost:8080/?action=stream
snapshot_url: http://localhost:8080/?action=snapshot
```

## Устранение неполадок

### Принтер не подключается
1. Проверьте IP-адрес и порт
2. Убедитесь, что Moonraker запущен
3. Проверьте сетевое подключение
4. Проверьте настройки брандмауэра

### Веб-камера не отображается
1. Проверьте URL веб-камеры
2. Убедитесь, что веб-камера доступна
3. Проверьте настройки CORS

### Ошибки загрузки файлов
1. Проверьте размер файла
2. Убедитесь, что формат файла поддерживается
3. Проверьте права доступа к папке uploads

## Разработка

### Добавление новых функций
1. Создайте новый endpoint в `app.py`
2. Добавьте соответствующий JavaScript код в `script.js`
3. Обновите HTML интерфейс при необходимости

### Настройка для продакшена
1. Отключите debug режим в Flask
2. Настройте WSGI сервер (Gunicorn, uWSGI)
3. Настройте обратный прокси (Nginx)
4. Добавьте SSL сертификат

## Лицензия

MIT License

## Поддержка

При возникновении проблем создайте issue в репозитории проекта или обратитесь к документации Moonraker API.
